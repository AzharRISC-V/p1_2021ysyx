## Linux常规操作

* 启用root账号

  $ sudo passwd root
  
  $ su root

* 更换apt更新源

  $ nano /etc/apt/sources.txt

* 虚拟机增强：

  $ apt install open-vm-tools

* 安装net-tools，支持ifconfig命令

  $ apt install net-tools

* 查看命令的实际路径
  
* which ls
  
* 查看登录信息
  
  * whoami 或 id
  
* 查看文件信息
  
  * file a.out
  
* 查看反汇编信息
  
  * objdump -d a.out  | vim -
  
* 更改主机名
  
* /etc/hostname
  
* 中文目录改英文名
  * 将中文路径重命名为英文
  * 打开~/.config/user-dirs.dirs，修改为需要的名称即可

* virtualbox共享文件夹权限问题
  * 默认时，共享目录所有者是root，所属组是vboxsf，而且无法更改，将自己加入vboxsf组
  * sudo usermod -aG vboxsf $(whoami)
  * 重启虚拟机

* ls的变体 ll，显示的信息更有规律，适合于编程处理

* 更改默认shell

  * chsh -s /usr/bin/zsh

* 配置zsh

  * apt install zsh
  * apt install zsh-autosuggestions zsh-syntax-highlighting zsh-theme-powerlevel9k

* MobaXTerm的X11无法使用方向键？出现2222,4444,6666,8888等

  * MobaXterm -> Settings -> Configuration -> X11 -> Keyboard -> us
  * 上述方法没有效果，后来说是 搜狗输入法的问题，切换回英文模式即可。

* linux安装字体

  ```
  $ cd ~/.local/share/fonts/
  $ mkdir myfonts
  $ cd myfonts
  $ cp ..
  $ sudo mkfontscale
  $ sudo mkfontdir
  $ sudo fc-cache -fv
  ```



### Linux下编译、字符串、文本技巧

* Vim技巧

  * 暂停/恢复按键输入

    * 暂停按键输入 Ctrl+S
    * 恢复按键输入 Ctrl+Q

  * 拷贝、粘贴、删除多行

    * 拷贝一行 yy
    * 拷贝多行 nyy
    * 粘贴 p
    * 删除一行 dd
    * 删除多行 ndd
    * 撤销 u

  * 查找字符串：

    * 从头开始查找：:/
    * 从结尾处查找 ：:?

  * 继续查找

    * 搜索下一处：n
    * 搜索上一处：N

  * 替换字符串

    ```
    格式：
    :<range> s/<search_str>/<replace_str>/<modifier>
    其中：
    range定义查找和替换范围
    	% 对整个文件执行
    	<start_line> <end_line> 在一组特定的行上进行
    modifier 确定替换行为
    	g 全局替换
    	gc 在每次更换之前要求确认 (global confirm)
    	gn 忽略替换功能并突出显示查找结果
    例如：
    :% s/apple/banana/gn
    
    ```

    

  * 翻页
    
    * 整页：Ctrl + f / b  (forward, backward)
    * 半页: Ctrl + d / u (down, up)
    * 一行：Ctrl + n / p (next, prev)
    
  * 定位到文档第一行：:0
    
  * 定位到文档最后一行：:$

* Linux下多窗口分屏式终端 Terminator

  * apt install terminator
  * terminator
  * 快捷键
  * Ctrl+Shift+E 新建水平窗口
    * Ctrl+Shift+O 新建垂直窗口
  * Ctrl+Tab 切换下一个窗口
    * Ctrl+Shift+N 后一个窗口（next）
  * Ctrl+Shift+P 前一个窗口（Prev）
    * Ctrl+Shift+W 关闭当前窗口
  
* 统计代码行数： 

  ```
  find . | grep '\.c$\|\.h$' | xargs wc -l
  ```

  解释：

  * A | B  管道符号，进程A的输出连接到进程B的输入

  * find . 是搜索当前文件夹下的所有文件
  * grep 传入的是正则表达式。其中，
    * 在\和$中的内容是判断是否指定结尾的行。
    * grep 后的单引号或双引号都可以，只要成对使用即可。
  * \ | 可能是为了转义，正在可能就这种写法。
  * wc命令加上 -l 参数能够计算代码行数。例如: wc -l aaa.c
  * xargs命令，它能将标准输入转换为参数，传送给第一个参数所指定的程序。于是，xargs wc -l 等价于 wc -l aaa.c bbb.cls

* 统计目录占用磁盘空间

  ```
  du -sc /usr/share/* | sort -nr | more
  du -sc /usr/share/* | sort -nr | less
  ```

  解释：

  * sort是数据排序。-n表示按照数值排序，-r是逆序（从大到小）

  * more 或 less提供了翻页功能
  * du -sc 将目录的大小顺次输出。

* 编写Hello world

  ```
  cd ~
  mkdir Templates
  cd Templates
  vim hello.c
  略去内容
  gcc hello.c -o hello
  ./hello
  ```

  * Linux下要执行当前目录下程序，需要输入 "./ xxx"，原因是，Linux有大量的标准工具，为消除命令访问的歧义，默认情况不搜索当前目录。

* 使用重定向

  ```
  objdump -d myprog > output
  objdump -d myprog | tee output
  > empty		# 创建一个空文件
  cat f1.txt > f2.txt		# 实现拷贝
  ./myprog < data.txt		# 将data.txt的内容作为标准输入，传给myprog程序
  ls > /dev/null			# 丢弃所有输出
  ```

  * 其中“>" 标准输出重定向符号，将输出重定向到文件中。
  * tee命令，同时输出至文件和屏幕
  * “<"是标准输入重定向符号。将 myprog的输入重定向为文件 data。尤其当程序需要多次输入，很繁琐时，可以这样自动化处理。

* 测试执行时间

  ```
  time ./myprog
  ```

* Makefile管理工程

  * Linux内核有25000+文件

  * 一个例子

    ```
    hello: hello.c
    	gcc hello.c -o hello	# 或者 gcc -o $@ $<
    
    .PHONY: clean
    
    clean:
    	rm hello
    ```

    注意：PHONY指示这是一个伪目标，make程序不会判断该文件的新旧，伪目标命令序列总是会执行。

## WSL2下的Ubuntu20.04配置

* 安装

  wsl1简单，但性能，gui支持差

  * 升级wsl2

    * 查看网站

    * 部分指令

      ```
      wsl --set-default-version 2
      wsl -l -v
      wsl --set-version Ubuntu20.04 2
      # 上面的转换重新打包新的文件结构为一个单独的文件，支持大小写敏感等。
      # 报错 Please enable the Virtual Machine Platform Windows feature and ensure virtualization is enabled in the BIOS.
      DISM /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V
      bcdedit /set hypervisorlaunchtype auto
      # 还是会失败，尝试将Win10升级到最新的21H1版本后就好了。
      # 继续查看
      wsl -l -v
      
      # wsl子系统还可以导出和导入
      # 导出
      wsl --export Ubuntu-20.04 d:\Ubuntu20.04.tar
      # 注销当前子系统
      wsl --ungrgister Ubuntu-20.04
      # 导入
      wsl --import Ubuntu-20.04 d:\Ubuntu-20.04.tar --version 2
      ```

* WSL文件位置

  * C:\Users\steven\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc\LocalState\rootfs
  * 默认环境变量 \\\wsl$

* 配置Windows Terminal软件

  命令行：ssl 192.168.1.2 -l username

  配色方案网站：

  https://windowsterminalthemes.dev/

  比较喜欢的几个：

  ​	Abernathy

* VSCode插件

  * Remote Development
  
* ocaml + owl 软件安装

  ```
  # apt更新源
  # apt更新和升级
  # 安装 build-essential
  # 安装 opam
  $ sudo apt-get install opam
  $ opam update
  $ opam upgrade
  $ opam init --disable-sandboxing #wsl中需要
  $ opam switch create 4.12.0
  # utop
  opam install utop
  # owl编译依赖
  sudo apt-get install pkg-config liblapacke-dev libopenblas-dev zlib1g-dev libgmp-dev
  # owl
  opam install owl
  # 仍然是 eigen 报错，版本是 0.3.0
  # https://opam.ocaml.org/packages/owl/ 这里可以查到一些版本信息
  # owl也一直在升级，现在2021年是1.0.1版本，记得之前甚至是 0.8.0 。
  # 尝试安装低一点的版本。
  $ opam switch create 4.12.0
  $ opam install owl.1.0.0
  【eigen问题解决办法，
  编译报错：cc1plus: error: bad value (‘tigerlake’) for ‘-march=’ switch #32
  可能是 gcc需要10.0版本。我看了虚拟机中确实是10.0，wsl中是9.3
  ===== eigen 0.3.0 安装错误的处理
  更新gcc/g++ 10.0
  $ sudo apt install gcc-10 g++-10
  设置优先级，数字越大，优先级越高
  $ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 100 --slave /usr/bin/g++ g++ /usr/bin/g++-10 --slave /usr/bin/gcov gcov /usr/bin/gcov-10
  $ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90 --slave /usr/bin/g++ g++ /usr/bin/g++-9 --slave /usr/bin/gcov gcov /usr/bin/gcov-9
  交互式的修改优先级。
  $ sudo update-alternatives --config gcc
  终于成了。wsl也可以用了。
  】
  # ocaml格式化和代码提示的工具
  opam install merlin
  opam user-setup install
  opam install ocp-indent
  opam user-setup install
  # 第三方库
  opam install yojson
  opam install cohttp
  ```
  
* WSL + IntelliJ IDEA (在windows下编辑，但是调用的是 linux中的编译环境)

  * 参考

    https://zhuanlan.zhihu.com/p/369912485

    IDEA官方网站

  * 安装步骤

    * 安装jdk，maven，并在IDEA中启用

      ```
      下载 idea community windows 版本，并安装
      # 在 wsl 中安装 jdk maven
      sudo apt install maven openjdk-11-jdk
      # 下载完后，IDEA会自动检测到wsl2中的jdk，并在新建项目时可用
      # maven 需要手动配置，
      # 在File - Settings - Build, Execution, Deployment - Build Tools - Maven中,将Maven home path改为
      \\wsl$\Ubuntu\usr\share\maven
      # User settings file 和 Local repository分别改为你想要存储的地方
      # 类似的，git等工具也能配置使用wsl2中的，而无需在Windows下安装和配置环境变量。
      ```

    * 将IDEA中Terminal的默认shell改为wsl2中的zsh

      ```
      #在File - Settings - Tools - Terminal 中 Shell path改为
      C:\Windows\System32\wsl.exe --distribution Ubuntu --exec /bin/zsh
      # Start directory保持默认（删光）即可
      # 这样配置后，在项目中打开内置terminal，就能直接使用zsh，并定位到项目地址
      ```

    * 注意事项

      ```
      # 由于使用的是linux下的jdk，项目地址也应保存在wsl2的文件目录下，否则可能会报错
      # Build时如果报错说连接超时，应该是防火墙问题，在Windows自带的防火墙中把IDEA设置为允许即可
      ```

      

* 